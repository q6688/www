import{s as t,n as s,G as i,E as n,o,c as a,w as l,b as c,K as r,l as d,J as h,k as p,i as f,q as u,T as m,U as k,z as g,V as y,f as C,F as x,g as $,h as _,e as w,W as I,v as T,L as b,O as P}from"./index-1c6cc45e.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";const U=function(t){let e="",s=btoa(window.location.href),i=encodeURIComponent(SQURL+"/"+t.$store.state.APIversion+"/api/oauthinfo.php?appid="+APPID+"&form="+s);e="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+APPID+"&redirect_uri="+i+"&response_type=code&scope=snsapi_userinfo&state=00#wechat_redirect",window.location.href=e};const v=L({emits:["newtime"],data:()=>({CircleTop:!1,vkey:0,ikey:0,videodemo:null}),props:{contenttype:{type:[Object,Number]}},mounted(){0==this.contenttype?t({title:this.$store.state.data.info.schoolname}):t({title:this.$store.state.data.info.hlname})},watch:{cover(t){this.ikey++,this.vkey++}},methods:{push(){this.$emit("newtime"),s({url:"/pages/push/push?type="+this.contenttype})},userClick(){U(this)},getqrcode(){let t=this.$store.state.APIURL+"/api/adimg/"+this.$store.state.data.info.schoolid+"/"+this.$store.state.data.info.userid+".adimg?token="+this.$store.state.data.token+"&APPID="+APPID;i({urls:[t]}),n({title:"长按保存图片到相册或转发给好友",icon:"success",duration:1e4})},changeCircleTop(){"31"!=this.$store.state.data.info.user_type&&"101"!=this.$store.state.data.info.user_type||(""==this.$store.state.data.admintoken&&(this.$store.commit("SetData",{key:"admintoken",data:this.$store.state.data.token}),this.$store.commit("SetData",{key:"mjtoken",data:this.$store.state.data.token})),window.location.href="/2588/"),n({title:"进入校园空间(正在开发)",icon:"none"})}}},[["render",function(t,e,s,i,n,m){const k=f,g=u;return o(),a(k,{class:p(["friendsCircle-top",{"friendsCircle-top-opend":n.CircleTop,"friendsCircle-top-type-img":"img"}]),key:n.ikey},{default:l((()=>[c(k,{style:{width:"100%",height:"100%"}},{default:l((()=>[c(k,{class:"image2 wxfont xiangji",onClick:m.push},null,8,["onClick"]),r("img",{class:"friendsCircle-top-img",onClick:e[0]||(e[0]=(...t)=>m.changeCircleTop&&m.changeCircleTop(...t)),src:0==this.contenttype?t.$store.state.data.info.schoolimg:t.$store.state.data.info.hlimg,referrerpolicy:"no-referrer",mode:"aspectFill"},null,8,["src"]),c(k,{class:"friendsCircle-top-information",onClick:m.userClick},{default:l((()=>[c(k,{class:"friendsCircle-top-information-user"},{default:l((()=>[c(k,{class:"friendsCircle-top-information-nikeName"},{default:l((()=>[d(h(0==this.contenttype?t.$store.state.data.info.nickname:t.$store.state.data.info.schoolname2+"-"+t.$store.state.data.info.nickname),1)])),_:1}),c(g,{class:"friendsCircle-top-information-avatar",src:t.$store.state.data.info.userimg,mode:"aspectFill"},null,8,["src"])])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-6b60ced7"]]);const D=L({data:()=>({keyboardHeight:50,msg:"",msgFocus:!1,toggleMsgBox:!1,showToolIndex:null,chooseUserIndex:null,type:"msg",placeholder:"评论",replydata:{type:0,contentid:"",tonickname:"",touserid:""},ing:!1}),props:{contenttype:{type:[Object,Number]},info:{type:[Object,String]},content:{type:Array,default:[]}},mounted(){},beforeDestroy(){this.$parent.$off("update",this.getlist)},methods:{getlist(){console.log("getlist",e)},replyclick(t,e,s){this.chooseUserIndex=s,t.userid==this.$store.state.data.info.userid?(this.hidenTool(),m({itemList:["复制","删除"],success:i=>{if(0==i.tapIndex)k({data:t.content,success:function(){n({title:"复制成功",icon:"none",position:"bottom"})}});else if(1==i.tapIndex){this.content[s].replyList.splice(e,1),this.replydata.type=0;let i=this.content[s].contentid;g({url:this.$store.state.APIURL+"/api/reply.php",method:"POST",data:{type:0,listid:this.content[s].listid,contentid:i,replyId:t.replyId,token:this.$store.state.data.token},success:t=>{console.log(t.data),200==t.data.code?n({title:t.data.msg,icon:"none"}):n({title:"删除失败",icon:"none"})}})}}})):(this.replydata.type=2,this.replydata.contentid=this.content[s].contentid,this.replydata.listid=this.content[s].listid,this.replydata.touserid=t.userid,this.replydata.tonickname=t.nickname,this.$nextTick((()=>{this.toggleMsgBox=!0,this.msgFocus=!0})))},gofriend(t){n({title:"目前不可以查看个人信息",icon:"none"})},pimgs(t,e){let s=[];for(let i=0;i<t.length;i++)s.push(t[i]);i({urls:s,current:e})},goMap(t){},openVideo(t){},returnParse:t=>JSON.parse(t),del(t,e){y({content:"删除该校园圈？",confirmText:"删除",success:s=>{s.confirm&&(this.content.splice(t,1),g({url:this.$store.state.APIURL+"/api/del.php",data:{contentid:e.contentid,token:this.$store.state.data.token,contenttype:this.contenttype},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:t=>{200==t.data.code&&n({title:t.data.msg,icon:"none"})}}))}})},showTool(t){this.chooseUserIndex=t,this.showToolIndex===t?this.showToolIndex=null:this.showToolIndex=t},comment(t){"10"!=this.$store.state.data.info.zt?(this.replydata.type=1,this.replydata.contentid=t.contentid,this.replydata.listid=t.listid,this.showToolIndex=null,this.type="msg",this.placeholder="评论",this.$nextTick((()=>{this.toggleMsgBox=!0,this.msgFocus=!0}))):U(this)},zan(t,e){if("10"==this.$store.state.data.info.zt)return void U(this);if(this.ing)return;this.ing=!0;let s=0,i="";if(i=0==this.contenttype?this.$store.state.data.info.nickname:this.$store.state.data.info.schoolname2+"-"+this.$store.state.data.info.nickname,t.like){this.hidenTool(),this.content[this.chooseUserIndex].like=!1;let t=this.arrFindkey({arr:this.content[this.chooseUserIndex].likeList,key:"userid",val:this.$store.state.data.info.userid});this.content[this.chooseUserIndex].likeList.splice(t.index,1),s=0}else this.hidenTool(),this.content[this.chooseUserIndex].like=!0,this.content[this.chooseUserIndex].likeList.push({userid:this.$store.state.data.info.userid,nickname:i}),s=1;console.log(t),g({url:this.$store.state.APIURL+"/api/like.php",data:{listid:t.listid,contentid:t.contentid,nickname:i,type:s,token:this.$store.state.data.token},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:t=>{200!=t.data.code&&n({title:"点赞失败",icon:"none"}),this.ing=!1},fail:()=>{this.ing=!1}})},arrFindkey:({arr:t,key:e,val:s})=>({item:t.find((function(t,i,n){return t[e]===s})),index:t.findIndex((function(t,i,n){return t[e]===s}))}),sendMsg(t){if(!t)return;if(this.ing)return;this.ing=!0;let e="";e=0==this.contenttype?this.$store.state.data.info.nickname:this.$store.state.data.info.schoolname2+"-"+this.$store.state.data.info.nickname;let s={};1==this.replydata.type?s={replyId:this.randomString(10),replyType:this.replydata.type,content:t,userid:this.$store.state.data.info.userid+"",nickname:e,canDeleted:"Y",touserid:"",tonickname:""}:2==this.replydata.type&&(s={replyId:this.randomString(10),replyType:this.replydata.type,content:t,userid:this.$store.state.data.info.userid,nickname:e,canDeleted:"Y",touserid:this.replydata.touserid,tonickname:this.replydata.tonickname}),this.hidenTool(),this.content[this.chooseUserIndex].replyList.push(s),this.msg="",g({url:this.$store.state.APIURL+"/api/reply.php",method:"POST",data:{type:1,listid:this.replydata.listid,contentid:this.replydata.contentid,content:s,token:this.$store.state.data.token},success:t=>{console.log(t.data),t.data.code,n({title:t.data.msg,icon:"none"}),this.ing=!1},fail:()=>{this.ing=!1}})},hidenTool(){this.showToolIndex=null,this.toggleMsgBox=!1},randomString(t){let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",i=s.length;for(let n=0;n<t;n++)e+=s.charAt(Math.floor(Math.random()*i));return e}}},[["render",function(t,e,s,i,n,r){const m=u,k=f,g=I,y=T,L=b,U=P;return o(),C(x,null,[(o(!0),C(x,null,$(s.content,((e,s)=>(o(),a(k,{class:"friendsCircle-content-item",key:s},{default:l((()=>[c(m,{class:"friendsCircle-content-avatar",src:e.img,mode:"aspectFill",onClick:t=>r.gofriend(e)},null,8,["src","onClick"]),c(k,{class:"friendsCircle-content-right"},{default:l((()=>[c(k,{class:"friendsCircle-content-nickname",onClick:t=>r.gofriend(e)},{default:l((()=>[d(h(e.nickname),1)])),_:2},1032,["onClick"]),c(k,{class:"friendsCircle-content-text"},{default:l((()=>[d(h(e.text),1)])),_:2},1024),"IMAGE"==e.type&&e.files.length>0?(o(),a(k,{key:0,class:"friendsCircle-content-imgs"},{default:l((()=>[(o(!0),C(x,null,$(e.files,((t,s)=>(o(),a(m,{key:s,class:p(["friendsCircle-content-img",{fci2:e.files.length>1,fci1:1==e.files.length}]),src:t,mode:"aspectFill",onClick:t=>r.pimgs(e.files,s)},null,8,["class","src","onClick"])))),128))])),_:2},1024)):_("",!0),"VIDEO"==e.type&&e.files.length>0?(o(),a(k,{key:1,class:"friendsCircle-content-video",onClick:t=>r.openVideo(e.files[0].videoUrl)},{default:l((()=>[c(g,{class:"friendsCircle-content-video-img",src:e.files[0].videoUrl,"enable-danmu":"","danmu-btn":"",controls:""},null,8,["src"])])),_:2},1032,["onClick"])):_("",!0),e.location.name?(o(),a(k,{key:2,class:"friendsCircle-content-location",onClick:t=>r.goMap(e.location)},{default:l((()=>[d(h(e.location.name),1)])),_:2},1032,["onClick"])):_("",!0),c(k,{class:"friendsCircle-content-tools"},{default:l((()=>[c(k,{class:"friendsCircle-content-time"},{default:l((()=>[d(h(e.time),1)])),_:2},1024),e.userid==t.$store.state.data.info.userid?(o(),a(k,{key:0,class:"friendsCircle-content-del wxfont del",onClick:t=>r.del(s,e)},null,8,["onClick"])):_("",!0),c(k,{class:p(["friendsCircle-content-tool",{tabon:s==n.showToolIndex}])},{default:l((()=>[c(k,{class:"wxfont caidan",onClick:t=>r.showTool(s)},null,8,["onClick"]),c(k,{class:"friendsCircle-content-tool-absolute"},{default:l((()=>[c(k,{class:"friendsCircle-popup"},{default:l((()=>[c(k,{class:"friendsCircle-popup-item",onClick:t=>r.zan(e,s)},{default:l((()=>[c(k,{class:"friendsCircle-popup-icon wxfont zan"}),e.like?(o(),a(k,{key:0,class:"friendsCircle-popup-text"},{default:l((()=>[d("取消")])),_:1})):(o(),a(k,{key:1,class:"friendsCircle-popup-text"},{default:l((()=>[d("赞")])),_:1}))])),_:2},1032,["onClick"]),c(k,{class:"friendsCircle-popup-item",onClick:t=>r.comment(e)},{default:l((()=>[c(k,{class:"friendsCircle-popup-icon wxfont pinglun"}),c(k,{class:"friendsCircle-popup-text"},{default:l((()=>[d("评论")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),e.likeList&&e.likeList.length>0?(o(),a(k,{key:3,class:"friendsCircle-like"},{default:l((()=>[c(k,{class:"friendsCircle-like-icon wxfont zan"}),(o(!0),C(x,null,$(e.likeList,((t,e)=>(o(),a(y,{class:"friendsCircle-like-text"},{default:l((()=>[d(h(t.nickname),1)])),_:2},1024)))),256))])),_:2},1024)):_("",!0),e.replyList&&e.replyList.length>0?(o(),a(k,{key:4,class:"friendsCircle-comment"},{default:l((()=>[(o(!0),C(x,null,$(e.replyList,((t,e)=>(o(),a(k,{class:"friendsCircle-comment-item",key:e},{default:l((()=>[c(y,{class:"friendsCircle-comment-text",onClick:e=>r.gofriend(t)},{default:l((()=>[d(h(t.nickname),1)])),_:2},1032,["onClick"]),"2"==t.replyType?(o(),a(k,{key:0,class:"friendsCircle-comment-feedback"},{default:l((()=>[d(" 回复 "),c(y,{class:"friendsCircle-comment-text",onClick:e=>r.gofriend(t)},{default:l((()=>[d(h(t.tonickname),1)])),_:2},1032,["onClick"])])),_:2},1024)):_("",!0),t.content?(o(),a(k,{key:1,class:"friendsCircle-comment-content",onClick:i=>r.replyclick(t,e,s)},{default:l((()=>[c(y,null,{default:l((()=>[d(h(t.content),1)])),_:2},1024)])),_:2},1032,["onClick"])):_("",!0)])),_:2},1024)))),128))])),_:2},1024)):_("",!0)])),_:2},1024)])),_:2},1024)))),128)),n.toggleMsgBox?(o(),a(k,{key:0,class:"zfb-tk-send-tool",style:w({bottom:n.keyboardHeight+"px"})},{default:l((()=>[c(U,{onSubmit:e[4]||(e[4]=t=>r.sendMsg(n.msg))},{default:l((()=>[c(k,{class:"zfb-tk-send-tool-c"},{default:l((()=>[c(k,{class:"zfb-tk-send-tool-input-box",onClick:e[2]||(e[2]=t=>n.msgFocus=!0)},{default:l((()=>[c(L,{class:"zfb-tk-send-tool-input","adjust-position":!1,focus:n.msgFocus,modelValue:n.msg,"onUpdate:modelValue":e[0]||(e[0]=t=>n.msg=t),placeholder:n.placeholder,"confirm-type":"send",onConfirm:e[1]||(e[1]=t=>r.sendMsg(n.msg)),"hold-keyboard":"",maxlength:-1,"auto-height":""},null,8,["focus","modelValue","placeholder"])])),_:1}),c(k,{class:"zfb-tk-send-tool-text",onClick:e[3]||(e[3]=t=>r.sendMsg(n.msg)),style:w({background:""!==n.msg?"#6aa84f":"#F7F7F7",color:""!==n.msg?"#fff":"#ddd","border-color":""!==n.msg?"#1BC418":"#ddd"})},{default:l((()=>[d(" 发送")])),_:1},8,["style"])])),_:1})])),_:1})])),_:1},8,["style"])):_("",!0)],64)}],["__scopeId","data-v-c4abce39"]]),F={getContentList:function(t){let e=Math.floor((new Date).getTime()/1e3/5);1==t.isnewtime&&(e=(new Date).getTime(),t.isnewtime=0);let s="";s=0==t.contenttype?t.$store.state.data.info.schoolid:t.$store.state.data.info.hlid;let i="/content/"+s+"-"+t.queryParams.pageNum+"-"+e+".contentlist";""!=s&&g({url:t.$store.state.APIURL+i,data:{pageNum:t.queryParams.pageNum,id:s,token:t.$store.state.data.token,contenttype:t.contenttype},success:e=>{console.log(e.data.time);let s=t.$store.state.data.info.userid,i=Date.parse(new Date),n=e.data.rows,o=[];for(let t=0;t<n.length;t++){if(0==n[t])continue;let e=JSON.parse(n[t]);e.like=!1;for(let t of e.likeList)if(s==t.userid){e.like=!0;break}i-e.time<6e4?e.time="刚刚":i-e.time<36e5?e.time=parseInt((i-e.time)/6e4)+"分钟前":i-e.time<864e5?e.time=parseInt((i-e.time)/36e5)+"小时前":e.time=new Date(e.time).toLocaleString(),o.push(e)}1==t.queryParams.pageNum?t.content=o:t.content=t.content.concat(o),t.queryParams.refreshing=!1},fail:t=>{console.log(t)}})}};export{v as _,D as a,F as c};
